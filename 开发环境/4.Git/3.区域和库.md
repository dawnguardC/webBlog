区域和库
===================
![](../相关文件/5.3.0.png)
Workspace：工作区——本地写代码的文件夹
Index / Stage：暂存区——临时存储待提交的修改文件
Repository：本地仓库——本地的版本库，保存所有提交记录
Remote：远程仓库

###  .git文件夹
工作区有一个隐藏目录.git，是记录提交的版本库。Git会自动创建一个主分支master，以及指向master一个版本的指针HEAD。

![](../相关文件/5.3.1.jpg)

###  版本跳转

#### reset
通过版本信息，就可以回滚到自己想要的版本，使用`git reset`命令进行版本跳转：

    git reset --hard HEAD~1
HEAD表示当前版本，向前n个版本就是`HEAD~n`。这样，实际调整HEAD指针指向的版本，并且用该版本库覆盖暂存区和工作区。这个版本后面的版本将不可log查看。

此时，如果想要向后回滚，如果Git Bash是一直没有关闭过，可以使用版本号进行跳转：

    $ git reset --hard c92e27
    HEAD is now at c92e27c add word hello
版本号写适当长度即可。
如果Git Bash关闭过，那就需要`git reflog`命令来查看Git的命令记录：

    $ git reflog
    c92e27c (HEAD -> master) HEAD@{0}: reset: moving to c92e27
    aa36acf HEAD@{1}: reset: moving to HEAD~1
    c92e27c (HEAD -> master) HEAD@{2}: commit: add word hello
    aa36acf HEAD@{3}: commit: add word github
    c6b5ae9 HEAD@{4}: commit (initial): add a test.txt
从这里也可以看到命令对应的版本号。

`git reset`命令的参数常用：
`--hard` 清除当前工作区和暂存区的修改
`--soft` 保留当前工作区和暂存区的修改
`--mixed` （默认值）清除暂存区，保留当前工作区的修改

#### revert
撤销提交，把这次撤销作为新的提交，不删除历史提交记录。
```
git revert -m "message" <commitId> 
git revert -m "message" HEAD

# 撤销从 a1b2c3d 到 e4f5g6h 之间的所有提交（不包含a1b2c3d）
git revert -m "message" a1b2c3d..e4f5g6h
```
工作区和暂存区会回到没做提交（被撤销的）的状态。

如果暂时不想提交，可以使用 -n 参数:
```
git revert -n <commitId>
```
**解决冲突**
假设提交历史：A → B → C，revert B 时，C的提交应该不受影响的，但B和C是改的同一行代码，就会冲突，需要解决冲突，再继续进行撤销B：
```
#手动修改完成后，继续撤销行为
git add .
git revert --continue
```
**撤销分支合并**
合并提交 merge 时，合并提交有两个父节点，必须用 -m 指定 “主线分支”（通常是 1，代表合并时的目标分支）。
```
#先撤销，再提交撤销记录
git revert <mergeCommitId> -m 1
git commit -m "撤销从feature合并到main的提交"
```

reset常用于删除暂存区的文件，其他使用revert。

###  撤销修改

如果文件还没有commit产生新版本，修改仅位于工作区，还没有提交到暂存区时，可以手动更改回去。也可以使用`git checkout -- <file>`命令来撤销所有工作区修改：

    git checkout -- test.txt
checkout -- 其实是用暂存区（没有add则用版本库）的版本替换工作区的版本。注意：`--`一定不要忘记。

如果文件已经提交到暂存区（git add），可以使用`git reset HEAD <file>`命令来将文件修改从暂存区回退到工作区：

    git reset HEAD test.txt
需要注意，如果进行过版本回滚，HEAD是指向回滚到的版本。

###  删除文件
如果要删除文件，那就用命令`git rm`，可以删除工作区文件，并且将这次删除放入暂存区。然后再`git commit`提交这次删除到版本库：

    git rm test.txt
    
    git commit -m "remove test.txt"
如果是误删除，并且还没有提交到版本库，可以：

    git checkout -- test.txt